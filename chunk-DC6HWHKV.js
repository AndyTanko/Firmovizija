import{a as P,b as y,c as A,d as I,f as L,g as M,h as R,l as j,n as T,o as N}from"./chunk-CYUVAYGI.js";import{n as g,o as E}from"./chunk-BGSMORQL.js";import{N as h,Na as a,Q as O,Ra as d,V as x,Wa as F,_a as m,eb as S,ib as c,k as w,mb as i,nb as r,o as f,ob as _,qb as k,rb as p,vb as l,xb as C,y as v}from"./chunk-WG5NLNBW.js";var b=class n{constructor(o,e){this.apiService=o;this.router=e;let t=localStorage.getItem("user");this.currentUserSubject=new w(t?JSON.parse(t):null),this.currentUser=this.currentUserSubject.asObservable()}authTokenKey="jwt_token";currentUserSubject;currentUser;get currentAuthToken(){return localStorage.getItem(this.authTokenKey)}login(o){return this.apiService.post("https://pzi9yg9hz5.execute-api.eu-central-1.amazonaws.com/Localhost/IDHandler",o).pipe(h(e=>{localStorage.setItem(this.authTokenKey,e.token),this.currentUserSubject.next(e.user)}),v(e=>(console.error("Login failed:",e),f(()=>new Error("Login failed. Please check your credentials.")))))}register(o){return this.apiService.post("auth/register",o).pipe(h(e=>{localStorage.setItem(this.authTokenKey,e.token),localStorage.setItem("user",JSON.stringify(e.user)),this.currentUserSubject.next(e.user)}),v(e=>(console.error("Registration failed:",e),f(()=>new Error("Registration failed. Please try again.")))))}isAuthenticated(){return!!this.currentAuthToken}logout(){localStorage.removeItem(this.authTokenKey),localStorage.removeItem("user"),this.currentUserSubject.next(null),this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||n)(x(N),x(g))};static \u0275prov=O({token:n,factory:n.\u0275fac,providedIn:"root"})};function G(n,o){if(n&1&&(i(0,"div",2),l(1),r()),n&2){let e=p();a(),C(" ",e.loginError," ")}}function B(n,o){n&1&&(i(0,"span"),l(1,"Username/Email is required."),r())}function K(n,o){if(n&1&&(i(0,"div",5),m(1,B,2,0,"span"),r()),n&2){let e,t=p();a(),c(!((e=t.loginForm.get("username"))==null||e.errors==null)&&e.errors.required?1:-1)}}function V(n,o){n&1&&(i(0,"span"),l(1,"Password is required."),r())}function J(n,o){if(n&1&&(i(0,"div",5),m(1,V,2,0,"span"),r()),n&2){let e,t=p();a(),c(!((e=t.loginForm.get("password"))==null||e.errors==null)&&e.errors.required?1:-1)}}var U=class n{constructor(o,e,t){this.fb=o;this.authService=e;this.router=t}loginForm;isSubmitting=!1;loginError=null;ngOnInit(){this.loginForm=this.fb.group({username:["",[y.required]],password:["",[y.required]]})}onSubmit(){if(this.loginError=null,this.loginForm.markAllAsTouched(),this.loginForm.invalid)return;this.isSubmitting=!0;let o=this.loginForm.value;this.authService.login(o).subscribe({next:e=>{console.log("Login successful",e),this.isSubmitting=!1,this.router.navigate(["/"])},error:e=>{console.error("Login failed:",e),this.loginError=e.message||"An unknown error occurred during login.",this.isSubmitting=!1}})}static \u0275fac=function(e){return new(e||n)(d(j),d(b),d(g))};static \u0275cmp=F({type:n,selectors:[["app-login"]],decls:21,vars:6,consts:[[1,"container","auth-container"],[3,"ngSubmit","formGroup"],[1,"error-message"],["for","username"],["type","text","id","username","name","username","formControlName","username"],[1,"validation-error"],["for","password"],["type","password","id","password","name","password","formControlName","password"],["type","submit",3,"disabled"],["routerLink","/register"]],template:function(e,t){if(e&1&&(i(0,"div",0)(1,"h1"),l(2,"Login"),r(),i(3,"form",1),k("ngSubmit",function(){return t.onSubmit()}),m(4,G,2,1,"div",2),i(5,"div")(6,"label",3),l(7,"Username/Email:"),r(),_(8,"input",4),m(9,K,2,1,"div",5),r(),i(10,"div")(11,"label",6),l(12,"Password:"),r(),_(13,"input",7),m(14,J,2,1,"div",5),r(),i(15,"button",8),l(16),r()(),i(17,"p"),l(18," Nemate nalog? "),i(19,"a",9),l(20,"Registrujte se ovde"),r()()()),e&2){let s,u;a(3),S("formGroup",t.loginForm),a(),c(t.loginError?4:-1),a(5),c((s=t.loginForm.get("username"))!=null&&s.invalid&&((s=t.loginForm.get("username"))!=null&&s.dirty||(s=t.loginForm.get("username"))!=null&&s.touched)?9:-1),a(5),c((u=t.loginForm.get("password"))!=null&&u.invalid&&((u=t.loginForm.get("password"))!=null&&u.dirty||(u=t.loginForm.get("password"))!=null&&u.touched)?14:-1),a(),S("disabled",t.loginForm.invalid||t.isSubmitting),a(),C(" ",t.isSubmitting?"Logging in...":"Login"," ")}},dependencies:[E,T,L,P,A,I,M,R],styles:[".container.auth-container[_ngcontent-%COMP%]{padding:20px;max-width:400px;margin:40px auto;border:1px solid #ddd;border-radius:8px;box-shadow:0 2px 4px #0000001a}h1[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-bottom:15px}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px}input[type=text][_ngcontent-%COMP%], input[type=password][_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;box-sizing:border-box;border-radius:4px}button[_ngcontent-%COMP%]{width:100%;padding:10px 15px;background-color:#28a745;color:#fff;border:none;cursor:pointer;border-radius:4px;font-size:1em}button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#218838}button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}p[_ngcontent-%COMP%]{text-align:center;margin-top:20px}a[_ngcontent-%COMP%]{color:#007bff;text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}.error-message[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:4px;margin-bottom:15px;text-align:center}.validation-error[_ngcontent-%COMP%]{color:#dc3545;font-size:.875em;margin-top:4px}input.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#dc3545}"]})};export{U as LoginComponent};
